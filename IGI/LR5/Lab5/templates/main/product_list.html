{% extends 'base.html' %}
{% block title %}Каталог товаров{% endblock %}

{% block content %}
<h1>Каталог товаров</h1>

<form method="get">
    <div>
        <input type="text" name="q" value="{{ current_q }}" placeholder="Поиск по названию...">
    </div>

    <div>
        <label>Категория:</label>
        <select name="category">
            <option value="">Все категории</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}" {% if current_category == cat.id|stringformat:"s" %}selected{% endif %}>
                {{ cat.name }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label>Производитель:</label>
        <select name="manufacturer">
            <option value="">Все производители</option>
            {% for man in manufacturers %}
            <option value="{{ man.id }}" {% if current_manufacturer == man.id|stringformat:"s" %}selected{% endif %}>
                {{ man.name }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label>Сортировка:</label>
        <select name="sort">
            <option value="">По названию</option>
            <option value="price" {% if current_sort == 'price' %}selected{% endif %}>
                По цене (возр.)
            </option>
            <option value="-price" {% if current_sort == '-price' %}selected{% endif %}>
                По цене (убыв.)
            </option>
        </select>
    </div>

    <button type="submit">Применить</button>
</form>

<div>
    {% for product in products %}
    <div>
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
        {% endif %}
        <h3>{{ product.name }}</h3>
        <p>{{ product.product_type.name }}</p>
        <p>{{ product.manufacturer.name }}</p>
        <p>{{ product.price }} руб.</p>
        <div>
            <a href="{% url 'product_detail' product.id %}">Подробнее</a>
        </div>
    </div>
    {% empty %}
    <p>Товары не найдены.</p>
    {% endfor %}
</div>
{% endblock %}
