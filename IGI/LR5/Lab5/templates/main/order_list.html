{% extends 'base.html' %}
{% block title %}Список заказов{% endblock %}

{% block content %}
<h1>Заказы</h1>

{# Кнопка создания нового заказа #}
{% if user.is_authenticated %}
  <p><a href="{% url 'order_create' %}">Создать новый заказ</a></p>
{% else %}
  <p><a href="{% url 'login' %}">Войдите</a>, чтобы создать заказ.</p>
{% endif %}

<table border="1" cellpadding="5" cellspacing="0">
  <thead>
    <tr>
      <th>Дата создания</th>
      <th>Дата доставки</th>
      <th>Сумма заказа</th>
      {% if user.is_staff %}
        <th>Клиент</th>
      {% endif %}
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for order in orders %}
      <tr>
        <td>{{ order.date_created|date:"Y-m-d H:i" }}</td>
        <td>{{ order.delivery_date }}</td>
        <td>{{ order.total_sum }}</td>
        {% if user.is_staff %}
          <td>{{ order.client.first_name }} {{ order.client.last_name }}</td>
        {% endif %}
        <td>
          <a href="{% url 'order_detail' order.pk %}">Просмотр</a>
          {% if user.is_staff or order.client.user == user %}
            | <a href="{% url 'order_edit' order.pk %}">Редактировать</a>
            | <a href="{% url 'order_delete' order.pk %}">Удалить</a>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="{% if user.is_staff %}5{% else %}3{% endif %}">
          Нет заказов.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
